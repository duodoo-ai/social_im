<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odooå¾®ä¿¡æœåŠ¡å·SSOæ¨¡å— - è¯´æ˜æ–‡æ¡£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7f9;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #07C160 0%, #05a54e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        .logo {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .section h2 {
            color: #07C160;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #07C160;
            display: inline-block;
        }
        .section h3 {
            color: #333;
            margin: 15px 0 10px;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .feature-card h4 {
            color: #07C160;
            margin-bottom: 10px;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        .field-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .field-table th, .field-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .field-table th {
            background-color: #f2f2f2;
        }
        .field-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .endpoints {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .endpoint {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #c8e6c9;
        }
        .endpoint:last-child {
            border-bottom: none;
        }
        .endpoint-method {
            display: inline-block;
            background: #07C160;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 10px;
        }
        .author-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        footer {
            text-align: center;
            padding: 20px;
            background: #333;
            color: white;
            margin-top: 30px;
        }
        @media (max-width: 768px) {
            .features {
                grid-template-columns: 1fr;
            }
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">ğŸ“±</div>
            <h1>Odooå¾®ä¿¡äºŒç»´ç æ‰«ç SSOæ¨¡å—</h1>
            <p><strong>é€šè¿‡å¾®ä¿¡äºŒç»´ç å®ç°Odooå•ç‚¹ç™»å½•çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ</strong></p>
        </header>

        <div class="content">
            <div class="section">
                <h2>æ¨¡å—æ¦‚è¿°</h2>
                <p>æœ¬æ¨¡å—ä¸ºOdooç³»ç»Ÿæä¾›äº†ä¸å¾®ä¿¡æœåŠ¡å·é›†æˆçš„å•ç‚¹ç™»å½•(SSO)åŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰«æå¾®ä¿¡äºŒç»´ç æˆ–é€šè¿‡å¾®ä¿¡å…¬ä¼—å·æˆæƒå¿«é€Ÿç™»å½•Odooç³»ç»Ÿï¼Œæ— éœ€è®°å¿†é¢å¤–çš„è´¦å·å¯†ç ã€‚</p>

                <div class="features">
                    <div class="feature-card">
                        <h4>å¾®ä¿¡é›†æˆ</h4>
                        <p>æ— ç¼å¯¹æ¥å¾®ä¿¡å¼€æ”¾å¹³å°APIï¼Œæ”¯æŒæœåŠ¡å·ç½‘é¡µæˆæƒå’Œç”¨æˆ·ä¿¡æ¯è·å–</p>
                    </div>
                    <div class="feature-card">
                        <h4>è‡ªåŠ¨ç”¨æˆ·åˆ›å»º</h4>
                        <p>æ”¯æŒé¦–æ¬¡ç™»å½•æ—¶è‡ªåŠ¨åˆ›å»ºOdooç”¨æˆ·è´¦æˆ·ï¼Œå¹¶å¯é…ç½®é»˜è®¤æƒé™ç»„</p>
                    </div>
                    <div class="feature-card">
                        <h4>ä¹±ç ä¿®å¤</h4>
                        <p>æ™ºèƒ½æ£€æµ‹å’Œä¿®å¤å¾®ä¿¡æ˜µç§°ä¹±ç é—®é¢˜ï¼Œæ”¯æŒå¤šç§ç¼–ç æ ¼å¼</p>
                    </div>
                    <div class="feature-card">
                        <h4>å®‰å…¨å¯é </h4>
                        <p>ä½¿ç”¨å¾®ä¿¡å®‰å…¨åè®®å’ŒOdooä¼šè¯ç®¡ç†ï¼Œç¡®ä¿ç™»å½•è¿‡ç¨‹å®‰å…¨</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>æ ¸å¿ƒåŠŸèƒ½</h2>

                <h3>å¾®ä¿¡ç”¨æˆ·è®¤è¯</h3>
                <p>é€šè¿‡OAuth2.0åè®®ä¸å¾®ä¿¡APIäº¤äº’ï¼Œè·å–ç”¨æˆ·æˆæƒå¹¶éªŒè¯èº«ä»½ï¼š</p>
                <div class="code-block">
// è®¤è¯æµç¨‹æ ¸å¿ƒä»£ç 
def auth_wechat(self, provider, code, params):
    if provider != 'wechat':
        return False

    # é€šè¿‡codeè·å–access_tokenå’Œopenid
    token_url = "https://api.weixin.qq.com/sns/oauth2/access_token"
    token_params = {
        'appid': config.app_id,
        'secret': config.app_secret,
        'code': code,
        'grant_type': 'authorization_code'
    }
    # è·å–ç”¨æˆ·ä¿¡æ¯å¹¶åˆ›å»º/æ›´æ–°Odooç”¨æˆ·
    # ...
                </div>

                <h3>ç”¨æˆ·ä¿¡æ¯ç®¡ç†</h3>
                <p>åœ¨res.usersæ¨¡å‹ä¸­æ‰©å±•äº†å¾®ä¿¡ç”¨æˆ·ç›¸å…³å­—æ®µï¼š</p>
                <table class="field-table">
                    <tr>
                        <th>å­—æ®µå</th>
                        <th>æè¿°</th>
                        <th>ç±»å‹</th>
                    </tr>
                    <tr>
                        <td>wechat_user_id</td>
                        <td>å¾®ä¿¡ç”¨æˆ·ID</td>
                        <td>Char</td>
                    </tr>
                    <tr>
                        <td>wechat_unionid</td>
                        <td>å¾®ä¿¡UnionID</td>
                        <td>Char</td>
                    </tr>
                    <tr>
                        <td>wechat_openid</td>
                        <td>å¾®ä¿¡OpenID</td>
                        <td>Char</td>
                    </tr>
                    <tr>
                        <td>wechat_nickname</td>
                        <td>å¾®ä¿¡æ˜µç§°</td>
                        <td>Char</td>
                    </tr>
                    <tr>
                        <td>wechat_sex</td>
                        <td>å¾®ä¿¡æ€§åˆ«</td>
                        <td>Selection</td>
                    </tr>
                    <tr>
                        <td>wechat_headimgurl</td>
                        <td>å¾®ä¿¡å¤´åƒURL</td>
                        <td>Char</td>
                    </tr>
                </table>

                <h3>ä¹±ç ä¿®å¤åŠŸèƒ½</h3>
                <p>æ™ºèƒ½è¯†åˆ«å’Œä¿®å¤å¾®ä¿¡æ˜µç§°ä¸­çš„ä¹±ç å­—ç¬¦ï¼š</p>
                <div class="code-block">
def fix_wechat_nickname(self, original_nickname):
    # å¤„ç†åŒé‡ç¼–ç é—®é¢˜
    if any(char in original_nickname for char in garbled_chars):
        try:
            fixed_bytes = original_nickname.encode('latin1')
            fixed_nickname = fixed_bytes.decode('utf-8')
            return fixed_nickname
        except (UnicodeEncodeError, UnicodeDecodeError):
            pass
    # å…¶ä»–å¤„ç†é€»è¾‘...
                </div>
            </div>

            <div class="section">
                <h2>é…ç½®è¯´æ˜</h2>

                <h3>å¾®ä¿¡æœåŠ¡å·é…ç½®</h3>
                <p>åœ¨Odooä¸­åˆ›å»ºå¾®ä¿¡é…ç½®è®°å½•ï¼Œå¡«å†™ä»å¾®ä¿¡å¼€æ”¾å¹³å°è·å–çš„å‚æ•°ï¼š</p>
                <table class="field-table">
                    <tr>
                        <th>å‚æ•°</th>
                        <th>è¯´æ˜</th>
                        <th>å¿…å¡«</th>
                    </tr>
                    <tr>
                        <td>App ID</td>
                        <td>å¾®ä¿¡å¼€å‘è€…åå°çš„AppID</td>
                        <td>æ˜¯</td>
                    </tr>
                    <tr>
                        <td>App Secret</td>
                        <td>å¾®ä¿¡å¼€å‘è€…åå°çš„AppSecret</td>
                        <td>æ˜¯</td>
                    </tr>
                    <tr>
                        <td>æˆæƒèŒƒå›´</td>
                        <td>snsapi_base(é™é»˜æˆæƒ)æˆ–snsapi_userinfo(ç”¨æˆ·ä¿¡æ¯æˆæƒ)</td>
                        <td>æ˜¯</td>
                    </tr>
                    <tr>
                        <td>è‡ªåŠ¨åˆ›å»ºç”¨æˆ·</td>
                        <td>æ˜¯å¦å…è®¸é¦–æ¬¡ç™»å½•æ—¶è‡ªåŠ¨åˆ›å»ºç”¨æˆ·</td>
                        <td>å¦</td>
                    </tr>
                    <tr>
                        <td>é»˜è®¤ç”¨æˆ·ç»„</td>
                        <td>è‡ªåŠ¨åˆ›å»ºç”¨æˆ·æ—¶åˆ†é…çš„æƒé™ç»„</td>
                        <td>å¦</td>
                    </tr>
                    <tr>
                        <td>ä¹±ç å­—ç¬¦é…ç½®</td>
                        <td>ç”¨äºæ£€æµ‹å¾®ä¿¡æ˜µç§°ä¹±ç çš„å­—ç¬¦åˆ—è¡¨</td>
                        <td>å¦</td>
                    </tr>
                </table>

                <h3>å›è°ƒURLé…ç½®</h3>
                <p>åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°ä¸­é…ç½®æˆæƒå›è°ƒåŸŸåä¸ºï¼š</p>
                <div class="code-block">
# æ ¼å¼ä¸ºï¼šhttps://ä½ çš„odooåŸŸå/wechat/callback
https://your-odoo-domain.com/wechat/callback
                </div>
            </div>

            <div class="section">
                <h2>APIç«¯ç‚¹</h2>

                <div class="endpoints">
                    <div class="endpoint">
                        <span class="endpoint-method">GET</span>
                        <strong>/wechat/callback</strong>
                        <p>å¾®ä¿¡æˆæƒå›è°ƒæ¥å£ï¼Œå¤„ç†ç”¨æˆ·æˆæƒåçš„è·³è½¬å’Œç”¨æˆ·ä¿¡æ¯è·å–</p>
                    </div>
                </div>

                <h3>å›è°ƒå‚æ•°</h3>
                <table class="field-table">
                    <tr>
                        <th>å‚æ•°</th>
                        <th>è¯´æ˜</th>
                    </tr>
                    <tr>
                        <td>code</td>
                        <td>å¾®ä¿¡è¿”å›çš„æˆæƒç ï¼Œç”¨äºè·å–access_token</td>
                    </tr>
                    <tr>
                        <td>state</td>
                        <td>è‡ªå®šä¹‰å‚æ•°ï¼Œç”¨äºé˜²æ­¢CSRFæ”»å‡»</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>å®‰è£…ä¸éƒ¨ç½²</h2>

                <h3>ä¾èµ–æ¨¡å—</h3>
                <ul>
                    <li>base</li>
                    <li>web</li>
                    <li>auth_oauth</li>
                </ul>

                <h3>å®‰è£…æ­¥éª¤</h3>
                <ol>
                    <li>å°†æ¨¡å—æ·»åŠ åˆ°Odooçš„addonsç›®å½•</li>
                    <li>åœ¨Odooåº”ç”¨ä¸­å®‰è£…"Odoo WeChat Service Account SSO"æ¨¡å—</li>
                    <li>è¿›å…¥è®¾ç½® â†’ å¾®ä¿¡ç™»å½•é…ç½®ï¼Œæ·»åŠ å¾®ä¿¡æœåŠ¡å·é…ç½®</li>
                    <li>åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®æˆæƒå›è°ƒåŸŸå</li>
                    <li>å¯ç”¨é…ç½®å¹¶æµ‹è¯•ç™»å½•åŠŸèƒ½</li>
                </ol>

                <h3>å®šæ—¶ä»»åŠ¡é…ç½®</h3>
                <p>æ¨¡å—æä¾›äº†å®šæ—¶æ›´æ–°å¾®ä¿¡access_tokençš„åŠŸèƒ½ï¼Œéœ€è¦åœ¨Odooä¸­é…ç½®å®šæ—¶ä»»åŠ¡ï¼š</p>
                <div class="code-block">
# å®šæ—¶ä»»åŠ¡æ–¹æ³•
def cron_update_access_token(self):
    """å®šæ—¶ä»»åŠ¡ï¼šæ›´æ–°æ‰€æœ‰æ´»è·ƒé…ç½®çš„å¾®ä¿¡token"""
    active_configs = self.search([('active', '=', True)])
    for config in active_configs:
        try:
            config.get_wechat_access_token()
        except Exception as e:
            # é”™è¯¯å¤„ç†...
            continue
    return True
                </div>
            </div>

            <div class="author-info">
                <h3>æ¨¡å—ä¿¡æ¯</h3>
                <p><strong>åç§°ï¼š</strong>Odoo WeChat Service Account SSO</p>
                <p><strong>ç‰ˆæœ¬ï¼š</strong>18.0.2.0</p>
                <p><strong>ä½œè€…ï¼š</strong>Jason Zou</p>
                <p><strong>è”ç³»æ–¹å¼ï¼š</strong>zou.jason@qq.com | 18951631470</p>
                <p><strong>ç½‘ç«™ï¼š</strong>http://www.duodoo.tech</p>
                <p><strong>è®¸å¯è¯ï¼š</strong>AGPL-3</p>
            </div>
        </div>

        <footer>
            <p>Â© 2025 Odooå¾®ä¿¡æœåŠ¡å·SSOæ¨¡å— | ç”±Jason Zouå¼€å‘</p>
        </footer>
    </div>
</body>
</html>